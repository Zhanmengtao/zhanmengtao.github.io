<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>詹梦涛的生信博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.zhanmengtao.top/"/>
  <updated>2019-10-30T15:45:30.156Z</updated>
  <id>http://www.zhanmengtao.top/</id>
  
  <author>
    <name>詹梦涛</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一个高杂合真菌基因组组装脚本</title>
    <link href="http://www.zhanmengtao.top/2019/10/30/%E5%A4%8D%E6%9D%82%E5%9F%BA%E5%9B%A0%E7%BB%84%E7%BB%84%E8%A3%85/"/>
    <id>http://www.zhanmengtao.top/2019/10/30/复杂基因组组装/</id>
    <published>2019-10-30T15:13:32.836Z</published>
    <updated>2019-10-30T15:45:30.156Z</updated>
    
    <content type="html"><![CDATA[<p>categories:<br>    - assemble</p><h3 id="前言及背景"><a href="#前言及背景" class="headerlink" title="前言及背景"></a>前言及背景</h3><p>什么是基因组de novo测序？其是对某一物种进行高通量测序，利用高性能计算平台和生物信息学方法，在不依赖于参考基因组的情况下进行组装，从而绘制该物种的全基因组序列图谱。</p><p>针对基因组的特性，基因组常被分为两类：普通（简单）基因组和复杂基因组。简单基因组指单倍体，纯合二倍体或者杂合度&lt;0.5%，且重复序列含量&lt;50%，GC含量为35%到65%之间的二倍体。复杂基因组则指杂合率＞0.5%，重复序列含量＞50%，GC含量处于异常的范围（GC含量＜35%或者GC含量＞＝65%的二倍体，多倍体。诺禾致源对二倍体复杂基因组进一步细分为微杂合基因组（0.5%＜杂合率＜＝0.8%、高杂合基因组（杂合率＞0.8%）以及高重复基因组（重复序列比例&gt;50%）。复杂基因组的组装一直以来都是一个让科研工作者为之头疼的问题。科研工作者也为解决这个问题一直努力着。随着三代测序平台的更迭，测序subreads的长度不断的增长，以及光学图谱技术的出现（Hic,10xGenomic等）。重复序列导致的组装困难逐步被缓解。但高杂合这一特性任一直困扰着科研工作者。</p><p>为了解决杂合组装，各式各样的方案不断被提出。总体思路有下：1.设计实验方案获取单倍体（例如种间杂种；案例：<a href="https://www.nature.com/articles/s41438-019-0139-1" target="_blank" rel="noopener">Sequencing a <em>Juglans regia</em> × <em>J. microcarpa</em> hybrid yields high-quality genome assemblies of parental species</a>）；2.设计适合于杂合基因组组装的软件，优化组装的算法；3.组装之后，再用去杂合软件去除杂合序列。</p><p>第一个思路很清晰，获取单倍体再测序，就解决了高杂合这个难点，可有时单倍体的获取真不是一般的难，局限性很大。</p><p>基于第二个思路，已有很多软件开发。有NOVOheter, Plantanus, MSR-CA，Plantanus-allee（Plantanus的升级版，支持Hic，10xGenomics等数据）等。此外还有一些软件有支持高杂合组装的模块，如Canu，SPAdes, Falon等。但实测的经验来看，效果都不是很好。</p><p>第三种思路的核心就是，居于相似性cut，目前接触过的的有Redundans，Haplomerger2，Purge_haplogs。Purge_haplogs除了考虑相似性，还有一大特性，就是通过分析比对read的覆盖度决定谁去谁留。此外，Haplomerger2和Purge_haplogs还支持重复序列部分的屏蔽。</p><p>今年我接手到了一个基因组大小为86M,杂合率约2.4%，重复序列率约为20%左右的真菌。测序策略为pacbio seq I + PE 150 。 本来打算再做一个Hic，但咨询一些测序公司之后，均表示真菌没有太多成功经验，且投入与产出可能不对等。故打消测Hic的念头。</p><p>基于已有的数据，我先采取了canu 单倍型组装、canu(多倍体模式，”batOptions=-dg 3 -db 3 -dr 1 -ca 500 -cp 50”组装，MECAT2，MaSuRCA、Falon、flye、wtdbg2 等组装软件进行了组装。接着使用 Purge_haplogs 、Redundans和Haplomerger2进行去杂合，然后再使用 FinisherSC进行基因组升级，最后使用nextpolish 进行 polish。经过测试，canu，MECAT2（经过nextpolish 进行 polish之后）， MaSuRCA的三个软件的表现相对较好。 去杂软件Purge_haplogs的适用性优于Redundans和Haplomerger2，去杂前后BUSCO评估基本不变。由于涉及到文章。故暂时只能提供最优的脚本。</p><h3 id="组装案例"><a href="#组装案例" class="headerlink" title="组装案例"></a>组装案例</h3><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 测序数据 Bam to Fastq or Fasta</span></span><br><span class="line">samtools fastq -0 012m.subreads.fq -@ 32 subreads.bam</span><br><span class="line"><span class="hljs-comment"># Assessment of genome size and heterozygosity(raw PE reads)</span></span><br><span class="line">mkdir genomescope</span><br><span class="line"><span class="hljs-built_in">cd</span> genomescope</span><br><span class="line">ln -s ../012m_L1_?.fq ./</span><br><span class="line">jellyfish count -C -m 21 -s 1000000000 -t 32 *.fq -o reads.jf</span><br><span class="line">jellyfish histo -t 32 reads.jf &gt; reads.histo</span><br><span class="line">Rscript /opt/biosoft/genomescope/genomescope.R reads.histo 21 150 output</span><br><span class="line"><span class="hljs-comment"># 二代数据质控</span></span><br><span class="line">mkdir Trimmomatic</span><br><span class="line"><span class="hljs-built_in">cd</span> Trimmomatic</span><br><span class="line">java -jar /opt/biosoft/Trimmomatic-0.36/trimmomatic-0.36.jar PE -threads 32 -phred33 ../012m_L1_1.fq ../012m_L1_2.fq 012m_Trimmomatic.1.fq 012m_Trimmomatic.unpaired.1.fq 012m_Trimmomatic.2.fq 012m_Trimmomatic.unpaired.2.fq \</span><br><span class="line">ILLUMINACLIP:/opt/biosoft/Trimmomatic-0.36/adapters/TruSeq3-PE-2.fa:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:20 MINLEN:75 TOPHRED33</span><br><span class="line"><span class="hljs-built_in">cd</span> ../</span><br><span class="line"><span class="hljs-comment"># correct Illumina reads | Assessment of genome size and heterozygosity</span></span><br><span class="line">mkdir Finderrors</span><br><span class="line"><span class="hljs-built_in">source</span> ~/.bash.pacbio</span><br><span class="line">ErrorCorrectReads.pl PHRED_ENCODING=33 READS_OUT=012m FILL_FRAGMENTS=0 KEEP_KMER_SPECTRA=1 PAIRED_READS_A_IN=../fastuniq/012m.fastuniq.1.fastq PAIRED_READS_B_IN=../fastuniq/012m.fastuniq.1.fastq PLOIDY=2 PAIRED_SEP=251 PAIRED_STDEV=48</span><br><span class="line"><span class="hljs-comment"># ErrorCorrectReads.pl也可以对基因组特性进行评估，但针对我的菌株来说，同已发布的邻近菌株比较，GenomeScope的结果要准确一些。</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># kmer plot</span></span><br><span class="line"><span class="hljs-built_in">cd</span> 012m.fastq.kspec</span><br><span class="line">perl -p -i -e <span class="hljs-string">'s/\@fns = \(\"frag_reads_filt.25mer.kspec\", \"frag_reads_edit.24mer.kspec\", \"frag_reads_corr.25mer.kspec\"\);\n//'</span> /opt/biosoft/ALLPATHS-LG/bin/KmerSpectrumPlot.pl</span><br><span class="line">KmerSpectrumPlot.pl SPECTRA=1 FREQ_MAX=255</span><br><span class="line">perl -p -i -e <span class="hljs-string">'s/\@fns = \(\"frag_reads_filt.25mer.kspec\", \"frag_reads_edit.24mer.kspec\", \"frag_reads_corr.25mer.kspec\"\);\n//'</span> /opt/biosoft/ALLPATHS-LG/bin/KmerSpectrumPlot.pl</span><br><span class="line">convert kmer_spectrum.cumulative_frac.log.lin.eps kmer_spectrum.cumulative_frac.log.lin.png</span><br><span class="line">convert kmer_spectrum.distinct.lin.lin.eps kmer_spectrum.distinct.lin.lin.png</span><br><span class="line">convert kmer_spectrum.distinct.log.log.eps kmer_spectrum.distinct.log.log.png</span><br><span class="line"><span class="hljs-built_in">cd</span> ../</span><br><span class="line"><span class="hljs-comment"># Using LoRDEC to modify PacBio Reads</span></span><br><span class="line">mkdir LoRDEC</span><br><span class="line"><span class="hljs-built_in">cd</span> LoRDEC</span><br><span class="line">lordec-correct -2 ../Finderrors/012m.paired.A.fastq ../Finderrors/012m.paired.B.fastq -i ../012m.subreads.fq -k 19 -o pacbio.LoRDEC.corrected.fasta -s 3 -T 32 &amp;&gt; lordec-correct.log</span><br><span class="line">seqkit seq -u pacbio.LoRDEC.corrected.fasta &gt; pacbio.corrected.fasta</span><br><span class="line"><span class="hljs-built_in">cd</span> ../</span><br><span class="line"><span class="hljs-comment">############# Genome assembly ###############</span></span><br><span class="line">mkdir MaSuRCA</span><br><span class="line"><span class="hljs-built_in">cd</span> MaSuRCA</span><br><span class="line"><span class="hljs-built_in">echo</span> <span class="hljs-string">'# example configuration file </span></span><br><span class="line"><span class="hljs-string">DATA</span></span><br><span class="line"><span class="hljs-string"># Illumina paired end reads supplied as &lt;two-character prefix&gt; &lt;fragment mean&gt; &lt;fragment stdev&gt; &lt;forward_reads&gt; &lt;reverse_reads&gt;</span></span><br><span class="line"><span class="hljs-string"># if single-end, do not specify &lt;reverse_reads&gt;</span></span><br><span class="line"><span class="hljs-string"># MUST HAVE Illumina paired end reads to use MaSuRCA</span></span><br><span class="line"><span class="hljs-string">PE= pe 251 48 /home/bioinfo/data/012m/012m_L1_1.fq  /home/bioinfo/data/012m/012m_L1_2.fq</span></span><br><span class="line"><span class="hljs-string"># Illumina mate pair reads supplied as &lt;two-character prefix&gt; &lt;fragment mean&gt; &lt;fragment stdev&gt; &lt;</span></span><br><span class="line"><span class="hljs-string">forward_reads&gt; &lt;reverse_reads&gt;</span></span><br><span class="line"><span class="hljs-string"># JUMP= sh 3600 200  /FULL_PATH/short_1.fastq  /FULL_PATH/short_2.fastq</span></span><br><span class="line"><span class="hljs-string"># pacbio OR nanopore reads must be in a single fasta or fastq file with absolute path, can be gzipped</span></span><br><span class="line"><span class="hljs-string"># if you have both types of reads supply them both as NANOPORE type</span></span><br><span class="line"><span class="hljs-string">PACBIO=/home/bioinfo/data/012m/LoRDEC/pacbio.corrected.fasta</span></span><br><span class="line"><span class="hljs-string"># NANOPORE=/FULL_PATH/nanopore.fa</span></span><br><span class="line"><span class="hljs-string"># Other reads (Sanger, 454, etc) one frg file, concatenate your frg files into one if you have many</span></span><br><span class="line"><span class="hljs-string"># OTHER=/FULL_PATH/file.frg</span></span><br><span class="line"><span class="hljs-string"># synteny-assisted assembly, concatenate all reference genomes into one reference.fa; works for Illumina-only data</span></span><br><span class="line"><span class="hljs-string"># REFERENCE=/FULL_PATH/nanopore.fa</span></span><br><span class="line"><span class="hljs-string">END</span></span><br><span class="line"><span class="hljs-string">PARAMETERS</span></span><br><span class="line"><span class="hljs-string"># PLEASE READ all comments to essential parameters below, and set the parameters according to your project</span></span><br><span class="line"><span class="hljs-string"># set this to 1 if your Illumina jumping library reads are shorter than 100bp</span></span><br><span class="line"><span class="hljs-string">EXTEND_JUMP_READS=0</span></span><br><span class="line"><span class="hljs-string"># this is k-mer size for deBruijn graph values between 25 and 127 are supported, auto will compute the optimal size based on the read data and GC content</span></span><br><span class="line"><span class="hljs-string">GRAPH_KMER_SIZE = auto</span></span><br><span class="line"><span class="hljs-string"># set this to 1 for all Illumina-only assemblies</span></span><br><span class="line"><span class="hljs-string"># set this to 0 if you have more than 15x coverage by long reads (Pacbio or Nanopore) or any other long reads/mate pairs (Illumina MP, Sanger, 454, etc)</span></span><br><span class="line"><span class="hljs-string">USE_LINKING_MATES = 0</span></span><br><span class="line"><span class="hljs-string"># specifies whether to run the assembly on the grid</span></span><br><span class="line"><span class="hljs-string">USE_GRID=0</span></span><br><span class="line"><span class="hljs-string"># specifies grid engine to use SGE or SLURM</span></span><br><span class="line"><span class="hljs-string">GRID_ENGINE=SGE</span></span><br><span class="line"><span class="hljs-string"># specifies queue (for SGE) or partition (for SLURM) to use when running on the grid MANDATORY</span></span><br><span class="line"><span class="hljs-string">GRID_QUEUE=all.q</span></span><br><span class="line"><span class="hljs-string"># batch size in the amount of long read sequence for each batch on the grid</span></span><br><span class="line"><span class="hljs-string">GRID_BATCH_SIZE=500000000</span></span><br><span class="line"><span class="hljs-string"># use at most this much coverage by the longest Pacbio or Nanopore reads, discard the rest of the reads</span></span><br><span class="line"><span class="hljs-string"># can increase this to 30 or 35 if your reads are short (N50&lt;7000bp)</span></span><br><span class="line"><span class="hljs-string">LHE_COVERAGE=25</span></span><br><span class="line"><span class="hljs-string"># set to 0 (default) to do two passes of mega-reads for slower, but higher quality assembly, otherwise set to 1</span></span><br><span class="line"><span class="hljs-string">MEGA_READS_ONE_PASS=0</span></span><br><span class="line"><span class="hljs-string"># this parameter is useful if you have too many Illumina jumping library mates. Typically set it to 60 for bacteria and 300 for the other organisms </span></span><br><span class="line"><span class="hljs-string"># LIMIT_JUMP_COVERAGE = 300</span></span><br><span class="line"><span class="hljs-string"># these are the additional parameters to Celera Assembler.  do not worry about performance, number or processors or batch sizes -- these are computed automatically. </span></span><br><span class="line"><span class="hljs-string"># CABOG ASSEMBLY ONLY: set cgwErrorRate=0.25 for bacteria and 0.1&lt;=cgwErrorRate&lt;=0.15 for other organisms.</span></span><br><span class="line"><span class="hljs-string">CA_PARAMETERS =  cgwErrorRate=0.15</span></span><br><span class="line"><span class="hljs-string"># CABOG ASSEMBLY ONLY: whether to attempt to close gaps in scaffolds with Illumina  or long read data</span></span><br><span class="line"><span class="hljs-string">CLOSE_GAPS=1</span></span><br><span class="line"><span class="hljs-string"># auto-detected number of cpus to use, set this to the number of CPUs/threads per node you will be using</span></span><br><span class="line"><span class="hljs-string">NUM_THREADS = 32</span></span><br><span class="line"><span class="hljs-string"># this is mandatory jellyfish hash size -- a safe value is estimated_genome_size*20</span></span><br><span class="line"><span class="hljs-string">JF_SIZE = 1740000000</span></span><br><span class="line"><span class="hljs-string"># ILLUMINA ONLY. Set this to 1 to use SOAPdenovo contigging/scaffolding module.  Assembly will be worse but will run faster. Useful for very large (&gt;=8Gbp) genomes from Illumina-only data</span></span><br><span class="line"><span class="hljs-string">SOAP_ASSEMBLY=0</span></span><br><span class="line"><span class="hljs-string">#Hybrid Illumina paired end + Nanopore/PacBio assembly ONLY.  Set this to 1 to use Flye assembler for final assembly of corrected mega-reads.  A lot faster than CABOG, at the expense of some contiguity. Works well even when MEGA_READS_ONE_PASS is set to 1.  DO NOT use if you have less than 15x coverage by long reads.</span></span><br><span class="line"><span class="hljs-string">FLYE_ASSEMBLY=0</span></span><br><span class="line"><span class="hljs-string">END '</span> &gt; config.txt</span><br><span class="line">/opt/biosoft/MaSuRCA-3.3.4/bin/masurca config.txt</span><br><span class="line">./assemble.sh</span><br><span class="line"></span><br><span class="line">mkdir purge_haplogs</span><br><span class="line"><span class="hljs-built_in">cd</span> purge_haplogs</span><br><span class="line">minimap2 -t 32 -ax map-pb ../final.genome.scf.fasta\</span><br><span class="line">/home/bioinfo/data/012m/canu/012m.correctedReads.fasta.gz | samtools view -hF 256 - | samtools sort -@ 32 -m 2G -o aligned.bam</span><br><span class="line">purge_haplotigs  hist  -b aligned.bam  -g ../final.genome.scf.fasta -t 20</span><br><span class="line">purge_haplotigs contigcov -i aligned.bam.gencov -o coverage_stats.csv -l 18 -m 76 -h 134</span><br><span class="line">purge_haplotigs purge -g ../final.genome.scf.fasta -c coverage_stats.csv -b aligned.bam -t 4 -a 50</span><br><span class="line"></span><br><span class="line">mkdir finisherSC</span><br><span class="line"><span class="hljs-built_in">cd</span> finisherSC</span><br><span class="line">ln -s ../curated.fasta ./contigs.fasta</span><br><span class="line">ln -s ~/data/012m/canu/012m.correctedReads.fasta ./raw_reads.fasta</span><br><span class="line">python /opt/biosoft/finishingTool/finisherSC.py ./ /opt/biosoft/mummer4/bin/</span><br><span class="line"></span><br><span class="line">mkdir NextPolish</span><br><span class="line"><span class="hljs-built_in">cd</span> NextPolish</span><br><span class="line">ls ~/data/012m/Finderrors/012m.paired.?.fastq &gt; sgs.fofn</span><br><span class="line"><span class="hljs-built_in">echo</span> <span class="hljs-string">'/home/bioinfo/data/012m/canu/012m.correctedReads.fasta'</span> &gt; lgs.fofn</span><br><span class="line"><span class="hljs-built_in">echo</span> <span class="hljs-string">'[General]</span></span><br><span class="line"><span class="hljs-string">job_type = local</span></span><br><span class="line"><span class="hljs-string">job_prefix = nextPolish</span></span><br><span class="line"><span class="hljs-string">task = default</span></span><br><span class="line"><span class="hljs-string">rewrite = yes</span></span><br><span class="line"><span class="hljs-string">rerun = 10</span></span><br><span class="line"><span class="hljs-string">parallel_jobs = 5</span></span><br><span class="line"><span class="hljs-string">multithread_jobs = 6</span></span><br><span class="line"><span class="hljs-string">genome = ../improved3.fasta</span></span><br><span class="line"><span class="hljs-string">genome_size = auto</span></span><br><span class="line"><span class="hljs-string">workdir = ./01_rundir</span></span><br><span class="line"><span class="hljs-string">polish_options = -p &#123;multithread_jobs&#125;</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">[sgs_option]</span></span><br><span class="line"><span class="hljs-string">sgs_fofn = ./sgs.fofn</span></span><br><span class="line"><span class="hljs-string">sgs_options = -max_depth 100 -bwa</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">[lgs_option]</span></span><br><span class="line"><span class="hljs-string">lgs_fofn = ./lgs.fofn</span></span><br><span class="line"><span class="hljs-string">lgs_options = -min_read_len 10k -max_read_len 150k -max_depth 60</span></span><br><span class="line"><span class="hljs-string">lgs_minimap2_options = -x map-pb</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">[polish_options]</span></span><br><span class="line"><span class="hljs-string">-ploidy 2 '</span> &gt; run.cfg</span><br><span class="line"></span><br><span class="line">/opt/biosoft/NextPolish/nextPolish run.cfg</span><br><span class="line"></span><br><span class="line">cat ./01_rundir/01.kmer_count/*polish.ref.sh.work/polish_genome*/genome.nextpolish.part*.fasta &gt; genome.nextpolish.fasta</span><br></pre></td></tr></table></figure><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><p><a href="https://wenku.baidu.com/view/737ef614f46527d3240ce0f1.html" target="_blank" rel="noopener">动植物基因组de novo常见问题</a><br><a href="http://www.wanfangdata.com.cn/details/detail.do?_type=perio&id=yc201811004" target="_blank" rel="noopener">杂基因组测序技术研究进展</a><br><a href="https://github.com/Nextomics/NextPolish/blob/master/doc/OPTION.md" target="_blank" rel="noopener">NextPolish</a><br><a href="https://www.nature.com/articles/s41438-019-0139-1" target="_blank" rel="noopener">Sequencing a <em>Juglans regia</em> × <em>J. microcarpa</em> hybrid yields high-quality genome assemblies of parental species</a><br><a href="https://www.jianshu.com/p/154584a3556f" target="_blank" rel="noopener">LoRDEC 利用二代数据纠错PacBio 数据</a><br><a href="https://github.com/schatzlab/genomescope" target="_blank" rel="noopener">genomescope</a><br><a href="https://github.com/alekseyzimin/masurca" target="_blank" rel="noopener">MaSuRCA</a><br><a href="https://bitbucket.org/mroachawri/purge_haplotigs/" target="_blank" rel="noopener">purge_haplogs</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;categories:&lt;br&gt;    - assemble&lt;/p&gt;
&lt;h3 id=&quot;前言及背景&quot;&gt;&lt;a href=&quot;#前言及背景&quot; class=&quot;headerlink&quot; title=&quot;前言及背景&quot;&gt;&lt;/a&gt;前言及背景&lt;/h3&gt;&lt;p&gt;什么是基因组de novo测序？其是对某一
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>De novo 基因组 GO 注释小窗口</title>
    <link href="http://www.zhanmengtao.top/2019/09/16/GO-annotation/"/>
    <id>http://www.zhanmengtao.top/2019/09/16/GO-annotation/</id>
    <published>2019-09-16T12:32:41.938Z</published>
    <updated>2019-09-17T07:31:02.956Z</updated>
    
    <content type="html"><![CDATA[<p>目前对于GO功能注释的思路有 以下常见的三种：</p><h2 id="BLAST-InterProScan-gt-omicsbox"><a href="#BLAST-InterProScan-gt-omicsbox" class="headerlink" title="BLAST+InterProScan =&gt; omicsbox"></a>BLAST+InterProScan =&gt; omicsbox</h2><p>可以先通过使用 blastp 进行nr注释，那么问题就来了，nr 数据库截至2018年12月已经有120G左右的数据量了，根据我的个人使用经验，对25000条蛋白进行32线程的并行化比对，差不多要半个月左右。很显然，在计算资源有限的条件下这是不现实的，那么大概就会出现两种思路：</p><h3 id="缩小数据库："><a href="#缩小数据库：" class="headerlink" title="缩小数据库："></a>缩小数据库：</h3><p>一种是使用Swiss-Prot等小的数据库进行注释；另一种就是根据基于taxid构建 nr子数据库了，具体的构建可见 基于taxid构建Blast database_bioinfomatics2medicine_新浪博客 </p><h3 id="diamond-Accelerated-BLAST-compatible-local-sequence-aligner"><a href="#diamond-Accelerated-BLAST-compatible-local-sequence-aligner" class="headerlink" title="diamond: Accelerated BLAST compatible local sequence aligner."></a>diamond: Accelerated BLAST compatible local sequence aligner.</h3><p>其主页介绍如下：</p><p>DIAMOND is a sequence aligner for protein and translated DNA searches, designed for high performance analysis of big sequence data. The key features are:</p><p>Pairwise alignment of proteins and translated DNA at 500x-20,000x speed of BLAST.</p><p>Frameshift alignments for long read analysis.</p><p>Low resource requirements and suitable for running on standard desktops or laptops.</p><p>Various output formats, including BLAST pairwise, tabular and XML, as well as taxonomic classification.</p><p>它就是那么快，相对于 blastp 的半个月，在 ‘–more-sensitive’ 模式下也仅需要4-5个小时。</p><p>在nr注释完之后,就到使用 omicsbox  mapping GO id 了。omicsbox 所有版本均需要购买，但价格比以前（Blast2GO）便宜很多。当然如果条件不允许，那么不如就来个本地化吧。</p><h2 id="diamond-及-Blast2go-的联用"><a href="#diamond-及-Blast2go-的联用" class="headerlink" title="diamond 及 Blast2go 的联用"></a>diamond 及 Blast2go 的联用</h2><h3 id="blast2go本地化"><a href="#blast2go本地化" class="headerlink" title="blast2go本地化"></a>blast2go本地化</h3><p>陈连福 centos6.9 代码：</p><p>installing Blast2go Databases</p><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/biosoft/blast2go</span><br><span class="line"></span><br><span class="line">cd /opt/biosoft/blast2go</span><br><span class="line"></span><br><span class="line">wget http:<span class="hljs-comment">//archive.geneontology.org/latest-full/go_monthly-assocdb-data.gz</span></span><br><span class="line"></span><br><span class="line">ascp -k <span class="hljs-number">1</span> -T -l <span class="hljs-number">200</span>M -<span class="hljs-selector-tag">i</span> ~/.aspera/connect/etc/asperaweb_id_dsa<span class="hljs-selector-class">.openssh</span> --host=ftp-private<span class="hljs-selector-class">.ncbi</span><span class="hljs-selector-class">.nlm</span><span class="hljs-selector-class">.nih</span><span class="hljs-selector-class">.gov</span> --user=anonftp --mode=recv /gene/DATA/gene_info<span class="hljs-selector-class">.gz</span> 。/</span><br><span class="line"></span><br><span class="line">ascp -k <span class="hljs-number">1</span> -T -l <span class="hljs-number">200</span>M -<span class="hljs-selector-tag">i</span> ~/.aspera/connect/etc/asperaweb_id_dsa<span class="hljs-selector-class">.openssh</span> --host=ftp-private<span class="hljs-selector-class">.ncbi</span><span class="hljs-selector-class">.nlm</span><span class="hljs-selector-class">.nih</span><span class="hljs-selector-class">.gov</span> --user=anonftp --mode=recv /gene/DATA/gene2accession<span class="hljs-selector-class">.gz</span> ./</span><br><span class="line"></span><br><span class="line">wget ftp:<span class="hljs-comment">//ftp.pir.georgetown.edu/databases/idmapping/idmapping.tb.gz</span></span><br></pre></td></tr></table></figure><p>注：对于不能使用aspera加速下载的文件可以试试 lftp -e ‘pget -n NUM -c url; exit’实行多线程下载</p><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gzip -dv go_monthly-assocdb-data.gz</span><br><span class="line"></span><br><span class="line">gzip -dv gene_info.gz</span><br><span class="line"></span><br><span class="line">gzip -dv gene2accession.gz</span><br><span class="line"></span><br><span class="line">gzip -dv idmapping<span class="hljs-selector-class">.tb</span><span class="hljs-selector-class">.gz</span></span><br><span class="line"></span><br><span class="line">tar zxf ~/software/local_b2g_db<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span></span><br><span class="line"></span><br><span class="line">mv local_b2g_db<span class="hljs-comment">/* ./  &amp;&amp; rm -rf local_b2g_db/</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">perl -p -i -e 's/go_201512-assocdb-data/go_2017-assocdb-data/' install_blast2goDB.sh</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">./install_blast2goDB.sh</span></span><br></pre></td></tr></table></figure><h3 id="下载NR-数据库到自己的Blast-db-中"><a href="#下载NR-数据库到自己的Blast-db-中" class="headerlink" title="下载NR 数据库到自己的Blast+ db 中"></a>下载NR 数据库到自己的Blast+ db 中</h3><figure class="highlight vim hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://ftp.ncbi.nlm.nih.gov/<span class="hljs-keyword">blast</span>/executables/<span class="hljs-keyword">blast</span>+/<span class="hljs-number">2.2</span>.<span class="hljs-number">28</span>/ncbi-<span class="hljs-keyword">blast</span>-<span class="hljs-number">2.2</span>.<span class="hljs-number">28</span>+-x64-linux.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxf ncbi-<span class="hljs-keyword">blast</span>-<span class="hljs-number">2.2</span>.<span class="hljs-number">28</span>+-x64-linux.tar.gz -C /<span class="hljs-keyword">opt</span>/biosoft/</span><br><span class="line"></span><br><span class="line">/<span class="hljs-keyword">opt</span>/biosoft/ncbi-<span class="hljs-keyword">blast</span>-<span class="hljs-number">2.2</span>.<span class="hljs-number">28</span>+/bin/blastdbcmd -db nr -entry <span class="hljs-keyword">all</span> -out nr.faa</span><br></pre></td></tr></table></figure><p>值得注意的是这里我用的blastdbcmd是ncbi-blast-2.2.28+的，输出的 nr.faa 文件中序列名是 “&gt;gi|66816243|ref|XP_642131.1| hypothetical protein DDB_G0277827” ，但如果用的是 ncbi-blast-2.6.0+的 blastdbcmd，输出没有GI号，原因可能是：As of September 2016, the integer sequence identifiers known as “GIs” will no longer be included in the GenBank, GenPept, and FASTA formats supported by NCBI for the display of sequence records.In addition, the FASTA format will no longer include the database source abbreviation. Please refer to the NCBI News Announcement posting for more detail.</p><figure class="highlight awk hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/bbuchfink/</span>diamond<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v0.9.24/</span>diamond-linux64.tar.gz</span><br></pre></td></tr></table></figure><p>注：如果在将diamond输出的XML文件导入到 b2g4pipe_v2.5 中出现 “Annotation of 0 seqs with 0 annots finished. Now searching for orfan IPRs…” 这个issues，那可能你的diamond版本有点旧了。</p><figure class="highlight jboss-cli hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf diamond-linux64.tar.gz</span><br><span class="line"></span><br><span class="line">mv diamond ~<span class="hljs-string">/bin/</span></span><br><span class="line"></span><br><span class="line">cp <span class="hljs-string">../interpro/proteins.fasta</span> <span class="hljs-string">./</span></span><br><span class="line"></span><br><span class="line">ascp -k 1 -T -l 200M -i ~<span class="hljs-string">/.aspera/connect/etc/asperaweb_id_dsa.openssh</span> <span class="hljs-params">--host=ftp-private</span>.ncbi.nlm.nih.gov <span class="hljs-params">--user=anonftp</span> <span class="hljs-params">--mode=recv</span> <span class="hljs-string">/pub/taxonomy/accession2taxid/prot.accession2taxid.gz</span> <span class="hljs-string">./prot.accession2taxid.gz</span></span><br><span class="line"></span><br><span class="line">ascp -k 1 -T -l 200M -i ~<span class="hljs-string">/.aspera/connect/etc/asperaweb_id_dsa.openssh</span> <span class="hljs-params">--host=ftp-private</span>.ncbi.nlm.nih.gov <span class="hljs-params">--user=anonftp</span> <span class="hljs-params">--mode=recv</span> <span class="hljs-string">/pub/taxonomy/taxdmp.zip</span> <span class="hljs-string">./</span></span><br><span class="line"></span><br><span class="line">unzip taxdmp.zip</span><br><span class="line"></span><br><span class="line"><span class="hljs-string">/opt/biosoft/ncbi-blast-2.2.28</span>+<span class="hljs-string">/bin/blastdbcmd</span> -db nr -entry all -out nr.faa</span><br><span class="line"></span><br><span class="line">diamond makedb <span class="hljs-params">--in</span> nr.faa -d nr <span class="hljs-params">--taxonmap</span> prot.accession2taxid.gz <span class="hljs-params">--taxonnodes</span> nodes.dmp <span class="hljs-comment">#### DIAMOND v0.9.24</span></span><br><span class="line"></span><br><span class="line">diamond blastp <span class="hljs-params">--query</span> proteins.fasta <span class="hljs-params">--more-sensitive</span> <span class="hljs-params">--db</span> nr <span class="hljs-params">--evalue</span> 1e-5 <span class="hljs-params">--salltitles</span> <span class="hljs-params">--threads</span> 64 <span class="hljs-params">--outfmt</span> 5 <span class="hljs-params">--out</span> nr.xml</span><br><span class="line"></span><br><span class="line">perl -p -e 's/diamond 0.9.24/BLASTP 2.2.26/' nr.xml &gt; nr_new.xml</span><br><span class="line"></span><br><span class="line">perl -p -i -e 's/^Dbacces.dbname=.*<span class="hljs-string">/Dbacces.dbname=b2gdb/</span>' b2gPipe.properties</span><br><span class="line"></span><br><span class="line">perl -p -i -e 's/^Dbacces.dbhost=.*<span class="hljs-string">/Dbacces.dbhost=127.0.0.1/</span>' b2gPipe.properties</span><br><span class="line"></span><br><span class="line">java -cp *<span class="hljs-function">:ext</span>/*: es.blast2go.prog.B2GAnnotPipe -in <span class="hljs-string">../nr_new.xml</span> -out go -annot -dat -annex</span><br></pre></td></tr></table></figure><h3 id="整合InterProScan的结果可以使用下面的脚本"><a href="#整合InterProScan的结果可以使用下面的脚本" class="headerlink" title="整合InterProScan的结果可以使用下面的脚本"></a>整合InterProScan的结果可以使用下面的脚本</h3><p>merge_interpro_to_go.pl b2g4pipe/go.annot ../interpro/interpro.tsv &gt; go.annot</p><h2 id="InterProScan"><a href="#InterProScan" class="headerlink" title="InterProScan"></a>InterProScan</h2><p>对于 InterProScan 可以本地化，也可以用 interProScan5.pl 将序列发送到官方服务器进行注释，资源允许，还是推荐本地化，网络版感觉还是有点慢～一个本地化教程: </p><p>InterProScan的使用教程 <a href="http://www.bioinfo-scrounger.com/archives/164" target="_blank" rel="noopener">http://www.bioinfo-scrounger.com/archives/164</a></p><h2 id="eggNOG-Mapper-（包括网页版和本地化）"><a href="#eggNOG-Mapper-（包括网页版和本地化）" class="headerlink" title="eggNOG-Mapper （包括网页版和本地化）"></a>eggNOG-Mapper （包括网页版和本地化）</h2><h3 id="网页版"><a href="#网页版" class="headerlink" title="网页版"></a>网页版</h3><p>关于这个注释方法网页版的推荐自己去摸索吧（就是和NCBI提交类似）=&gt; <a href="http://eggnogdb.embl.de/#/app/emapper" target="_blank" rel="noopener">http://eggnogdb.embl.de/#/app/emapper</a></p><h3 id="本地化推荐两个教程吧："><a href="#本地化推荐两个教程吧：" class="headerlink" title="本地化推荐两个教程吧："></a>本地化推荐两个教程吧：</h3><p>序列功能注释神器：eggNOG-mapper，KEGG/COG/KOG/GO/BiGG 一网打尽 ： 序列功能注释神器：eggNOG-mapper，KEGG/COG/KOG/GO/BiGG 一网打尽 « Biostack.org =&gt; <a href="http://www.biostack.org/?p=698" target="_blank" rel="noopener">http://www.biostack.org/?p=698</a></p><p>应该是最好的eggnog-mapper功能注释教程：应该是最好的eggnog-mapper功能注释教程 - 简书（生信媛）=&gt; <a href="https://www.jianshu.com/p/e646c0fa6443" target="_blank" rel="noopener">https://www.jianshu.com/p/e646c0fa6443</a></p><p>个人思考:</p><p>对于准确性的个人思考，基于比对，也就是基因相似性的注释方法(blastp,diamond)可能会取决于数据库的大小，因为在omicsbox中有涉及到相似度cut这一步，如果数据库不够大，那么相似度有的可能只为50(在cut值之上)，所以只使用Swiss-Prot等小数据库注释时可能需要提高cut值.</p><p>eggnog的注释，存在两种模式diamond和hummer，前者官方推荐为存在接近物种，也就是在直系同源注释中有更好的表现，hummer则反之. 同样的，只要是比对，就会有cut相似度这一说，数据库的大小及深度(涉及的物种)，就会影响结果。其一个特点在于直系同源注释。这点omicsbox中出了filter with Taxid 来补充。</p><p>我个人觉得目前还是blast+interpro的准确性会更高一些，当然如果eggnog持续开发,扩大其数据库，以及支持整合diamond和hummer的结果将会成为新的宠儿。</p><p>参考资料</p><p><a href="http://blog.sina.com.cn/s/blog_16152d7d70102xnc3.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_16152d7d70102xnc3.html</a></p><p><a href="https://github.com/bbuchfink/diamond" target="_blank" rel="noopener">https://github.com/bbuchfink/diamond</a></p><p><a href="http://www.jinciwei.cn/a342744.html" target="_blank" rel="noopener">http://www.jinciwei.cn/a342744.html</a></p><p><a href="https://github.com/bbuchfink/diamond/issues/79" target="_blank" rel="noopener">https://github.com/bbuchfink/diamond/issues/79</a></p><p><a href="https://github.com/bbuchfink/diamond/issues/159" target="_blank" rel="noopener">https://github.com/bbuchfink/diamond/issues/159</a></p><p><a href="https://github.com/bbuchfink/diamond/issues/165" target="_blank" rel="noopener">https://github.com/bbuchfink/diamond/issues/165</a></p><p><a href="http://www.biostack.org/?p=698" target="_blank" rel="noopener">http://www.biostack.org/?p=698</a></p><p><a href="https://www.jianshu.com/p/e646c0fa6443" target="_blank" rel="noopener">https://www.jianshu.com/p/e646c0fa6443</a></p><p>NGS 生物信息学分析 V6.0 陈连福 郑越</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;目前对于GO功能注释的思路有 以下常见的三种：&lt;/p&gt;
&lt;h2 id=&quot;BLAST-InterProScan-gt-omicsbox&quot;&gt;&lt;a href=&quot;#BLAST-InterProScan-gt-omicsbox&quot; class=&quot;headerlink&quot; title=&quot;B
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://www.zhanmengtao.top/2019/09/16/hello-world/"/>
    <id>http://www.zhanmengtao.top/2019/09/16/hello-world/</id>
    <published>2019-09-16T03:35:12.762Z</published>
    <updated>2019-09-16T03:35:12.763Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="hljs-string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
